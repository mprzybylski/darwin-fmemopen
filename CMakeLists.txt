cmake_minimum_required(VERSION 3.7)
project(darwin_fmemopen)

#[[ Versioning information for dynamic libraries
See https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/DynamicLibraryDesignGuidelines.html
and http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html for more background. ]]
set(FMEMOPEN_BUILD_VER 0.1)
set(FMEMOPEN_API_VER 0)

set(EDIT_WARNING "Generated by CMake.  DO NOT EDIT")

# TODO: reroute output file to project build directory?
configure_file(resources/libfmemopen.pc.cmakein resources/libfmemopen.pc @ONLY)

include_directories(include)

#[[ Each library must be compiled from scratch because the shared library is
"position independent" while the static library is not, for better performance ]]
add_library(fmemopen SHARED src/fmemopen.c)
add_library(fmemopen_static STATIC src/fmemopen.c)
set_target_properties(fmemopen fmemopen_static
        PROPERTIES
        VERSION ${FMEMOPEN_BUILD_VER}
        SOVERSION ${FMEMOPEN_API_VER}
        OUTPUT_NAME fmemopen # use the same base name for the .a and the .dylib
        )

install(TARGETS fmemopen fmemopen_static
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib
        PUBLIC_HEADER DESTINATION include)

install(FILES resources/libfmemopen.pc
        DESTINATION lib/pkgconfig)